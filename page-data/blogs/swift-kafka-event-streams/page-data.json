{"componentChunkName":"component---src-templates-blogs-js","path":"/blogs/swift-kafka-event-streams","result":{"data":{"blog":{"html":"<p>We have just released <a href=\"https://github.com/Kitura/SwiftKafka\">SwiftKafka</a>, a new Swift package for producing and consuming from an Apache Kafka distributed streaming platform. This blog post explains why you would use Apache Kafka, how you can use the Swift Kafka API and provides an example of producing and consuming messages.</p>\n<h2 id=\"what-is-apache-kafka\"><a href=\"#what-is-apache-kafka\" aria-label=\"what is apache kafka permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is Apache Kafka?</h2>\n<p>Apache Kafka is a distributed event streaming platform capable of handling trillions of events a day. A streaming platform has three key capabilities:</p>\n<ul>\n<li>Publish and subscribe to streams of records, similar to a message queue or enterprise messaging system.</li>\n<li>Store streams of records in a fault-tolerant durable way.</li>\n<li>Process streams of records as they occur.</li>\n</ul>\n<p>Instead of sending messages directly from a producer to a consumer, Kafka stores streams of records in categories called topics. Producers add messages to a topic and consumers read messages from a topic. Producing and consuming from a stream is very cheap and works with Kafka’s built in distributed architecture. The result is a messaging system that is fast, fault tolerant and can handle high volumes of data.</p>\n<p>If you would like to learn more about Kafka, check out the <a href=\"https://kafka.apache.org/intro.html\">Apache Kafka website</a>.</p>\n<hr>\n<h2 id=\"swift-kafka\"><a href=\"#swift-kafka\" aria-label=\"swift kafka permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Swift Kafka</h2>\n<p>The new <a href=\"https://github.com/Kitura/SwiftKafka\">SwiftKafka</a> library is built on top of the <a href=\"https://github.com/edenhill/librdkafka\">librdkafka</a> C library. This provides high performance messaging with an easy to use Swift API. Swift Kafka provides three classes that you will need to connect your application to event streams:</p>\n<h3 id=\"kafkaproducer\"><a href=\"#kafkaproducer\" aria-label=\"kafkaproducer permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KafkaProducer</h3>\n<p>The <code class=\"language-text\">KafkaProducer</code> class produces messages to a Kafka server.</p>\n<p>Once you have initialized a KafkaProducer, you can call <code class=\"language-text\">connect(brokers:)</code> to connect to one or more Kafka servers.</p>\n<p>The producer can then call <code class=\"language-text\">send()</code> with a <code class=\"language-text\">KafkaProducerRecord</code>, which contains the following fields:</p>\n<ul>\n<li>Topic: The topic where the producer sends the record. If this topic doesn’t exist, the producer will try to create it.</li>\n<li>Value: The body of the message that will be sent with the record.</li>\n<li>Partition: The topic partition where the producer sends the record. If this is not set the server will automatically assign the partition.</li>\n<li>Key: If the partition is not set, the server will assign records with the same key to the same partition. Since order is guaranteed within a partition, these records will be consumed in the order they were produced.</li>\n</ul>\n<p>The message is sent to the connected brokers and the Kafka server stores the message on a partition of the topic.</p>\n<h3 id=\"kafkaconsumer\"><a href=\"#kafkaconsumer\" aria-label=\"kafkaconsumer permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KafkaConsumer</h3>\n<p>The <code class=\"language-text\">KafkaConsumer</code> class consumes messages from a Kafka server.</p>\n<p>Once you have initialized a <code class=\"language-text\">KafkaConsumer</code>, you can call <code class=\"language-text\">connect(brokers:)</code> to connect to one or more Kafka servers.</p>\n<p>You can then subscribe to topics using <code class=\"language-text\">subscribe()</code>. This will distribute the topic partitions evenly between consumers with the same group id. If you do not set a group id, a random UUID will be used.</p>\n<p>Alternatively, you can use <code class=\"language-text\">assign()</code> to manually set the partition and offset where the consumer will consume from.</p>\n<p>Both <code class=\"language-text\">subscribe()</code> and <code class=\"language-text\">assign()</code> are asynchronous and will return immediately, however they may take up to sessionTimeoutMs (default 10 seconds) * 2 before the consumer connects and is assigned partitions.</p>\n<p>To consume messages from Kafka you call poll <code class=\"language-text\">(timeout:)</code>. This will poll Kafka, blocking for timeout seconds. When the function completes, you are returned an array of <code class=\"language-text\">KafkaConsumerRecord</code>, with the following fields:</p>\n<ul>\n<li>Value: The message value, if it can be UTF8 decoded to a String.</li>\n<li>ValueData: The message value as raw data.</li>\n<li>Key: The message key, if it can be UTF8 decoded to a String.</li>\n<li>KeyData: The message key as raw data.</li>\n<li>Offset: The message offset.</li>\n<li>Topic: The topic that the message was consumed from.</li>\n<li>Partition: The partition that the message was consumed from.</li>\n</ul>\n<p>When you have finished consuming, you can call <code class=\"language-text\">close()</code> to close the connection and unassign the consumer. The Kafka server then rebalances the unassigned partitions between other consumers in the group. If you don’t call <code class=\"language-text\">close()</code>, the consumer will be closed when the class is deallocated.</p>\n<h3 id=\"kafkaconfig\"><a href=\"#kafkaconfig\" aria-label=\"kafkaconfig permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KafkaConfig</h3>\n<p>The <code class=\"language-text\">KafkaConfig</code> class contains your settings for a Kafka consumer or Kafka producer. You pass an instance of this class to the Kafka client initializer to set its configuration.</p>\n<p>You initialize the class with default values, which you can change using the helper functions. For example, if you want to enable all logging, you would set the debug variable:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> config <span class=\"token operator\">=</span> <span class=\"token function\">KafkaConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nconfig<span class=\"token punctuation\">.</span>debug <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span>all<span class=\"token punctuation\">]</span></code></pre></div>\n<hr>\n<h2 id=\"swift-kafka-example\"><a href=\"#swift-kafka-example\" aria-label=\"swift kafka example permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Swift Kafka Example</h2>\n<p>To demonstrate Swift Kafka, we are going to create a producer that reads user input and sends it to the Kafka server and a consumer that reads the message and prints it back to the user. The first thing we need is a Kafka server to connect to:</p>\n<h3 id=\"setting-up-a-kafka-server-mac\"><a href=\"#setting-up-a-kafka-server-mac\" aria-label=\"setting up a kafka server mac permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting up a Kafka Server (Mac)</h3>\n<p>For macOS, we will use <a href=\"https://brew.sh\">Homebrew</a> to install and run the server:</p>\n<ol>\n<li>Install <code class=\"language-text\">librdkafka</code> (required to build SwiftKafka)</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ brew install librdkafka</code></pre></div>\n<ol start=\"2\">\n<li>Install Kafka server (and Java dependency)</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ brew cask install java\n$ brew install kafka</code></pre></div>\n<ol start=\"3\">\n<li>Start the Zookeeper service</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ brew services start zookeeper</code></pre></div>\n<ol start=\"4\">\n<li>Start the Kafka service</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ brew services start kafka</code></pre></div>\n<p>These commands will install and run Zookeeper and Kafka as background services. Zookeeper is a centralized service that maintains information within distributed systems and is required by Kafka.</p>\n<hr>\n<h3 id=\"setting-up-a-kafka-server-linux\"><a href=\"#setting-up-a-kafka-server-linux\" aria-label=\"setting up a kafka server linux permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting up a Kafka Server (Linux)</h3>\n<p>On Linux, please follow the <a href=\"https://kafka.apache.org/quickstart\">Kafka quick start instructions</a> and <a href=\"https://github.com/edenhill/librdkafka#installing-prebuilt-packages\">install librdkafka</a>.</p>\n<hr>\n<h3 id=\"create-a-kafka-producer\"><a href=\"#create-a-kafka-producer\" aria-label=\"create a kafka producer permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a Kafka Producer</h3>\n<p>We will create a simple producer that reads user input from the terminal and sends it to a Kafka topic using Swift Kafka.</p>\n<ol>\n<li>Create an executable Swift project</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ mkdir kafkaProducer\n$ cd kafkaProducer/\n$ swift package init --type executable</code></pre></div>\n<ol start=\"2\">\n<li>Add Swift Kafka</li>\n</ol>\n<p>Open your <code class=\"language-text\">Package.swift</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ open Package.swift</code></pre></div>\n<p>Add Swift Kafka to your dependencies:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.package(url: &quot;https://github.com/Kitura/SwiftKafka.git&quot;, from: &quot;0.0.0&quot;)</code></pre></div>\n<p>Then add <code class=\"language-text\">SwiftKafka</code> to your target dependencies.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.target(\n            name: &quot;kafkaProducer&quot;,\n            dependencies: [&quot;SwiftKafka&quot;]),</code></pre></div>\n<ol start=\"3\">\n<li>Add the <code class=\"language-text\">KafkaProducer</code> code</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">open Sources/kafkaProducer/main.swift</code></pre></div>\n<p>Replace the code in this file with:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">SwiftKafka</span>\n\n<span class=\"token keyword\">let</span> config <span class=\"token operator\">=</span> <span class=\"token function\">KafkaConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nconfig<span class=\"token punctuation\">.</span>brokerAddressFamily <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span>v4\n<span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> producer <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span><span class=\"token operator\">?</span> <span class=\"token function\">KafkaProducer</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">let</span> connection <span class=\"token operator\">=</span> producer<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>brokers<span class=\"token punctuation\">:</span> <span class=\"token string\">\"localhost:9092\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Connected to <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>connection<span class=\"token delimiter variable\">)</span></span> brokers\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Enter message to produce to Kafka:\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> userInput <span class=\"token operator\">=</span> <span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            producer<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>producerRecord<span class=\"token punctuation\">:</span> <span class=\"token function\">KafkaProducerRecord</span><span class=\"token punctuation\">(</span>topic<span class=\"token punctuation\">:</span> <span class=\"token string\">\"example\"</span><span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">:</span> userInput<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> result <span class=\"token keyword\">in</span>\n                <span class=\"token keyword\">switch</span> result <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> record<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Successfully produced: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>record<span class=\"token punctuation\">.</span>value <span class=\"token keyword\">as</span> <span class=\"token builtin\">Any</span><span class=\"token delimiter variable\">)</span></span> to offset: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>record<span class=\"token punctuation\">.</span>offset<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to send message with error: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>error<span class=\"token punctuation\">.</span>description<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This code will initialize a new KafkaProducer. We have configured our producer to only connect to brokers on IPv4 since we are running on localhost. We then connect to the Kafka server we started earlier on the default port of “9092”. The program will then read user input from the terminal and send it to the broker.</p>\n<p>You can test this out by running the program in terminal:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ swift run</code></pre></div>\n<hr>\n<h3 id=\"create-a-kafka-consumer\"><a href=\"#create-a-kafka-consumer\" aria-label=\"create a kafka consumer permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a Kafka Consumer</h3>\n<p>We will create a simple consumer that reads everything from a topic and prints it to the terminal.</p>\n<ol>\n<li>Create an executable Swift project</li>\n</ol>\n<p>We start by creating an executable Swift project using the same steps as above:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ mkdir kafkaConsumer\n$ cd kafkaConsumer/\n$ swift package init --type executable</code></pre></div>\n<ol start=\"2\">\n<li>Add Swift Kafka</li>\n</ol>\n<p>Open your <code class=\"language-text\">Package.swift</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ open Package.swift</code></pre></div>\n<p>Add Swift Kafka to your dependencies:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.package(url: &quot;https://github.com/Kitura/SwiftKafka.git&quot;, from: &quot;0.0.0&quot;)</code></pre></div>\n<p>Then add <code class=\"language-text\">SwiftKafka</code> to your target dependencies.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.target(\n            name: &quot;kafkaProducer&quot;,\n            dependencies: [&quot;SwiftKafka&quot;]),</code></pre></div>\n<ol start=\"3\">\n<li>Add the <code class=\"language-text\">KafkaConsumer</code> code</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">open Sources/kafkaConsumer/main.swift</code></pre></div>\n<p>Replace the code in this file with:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">SwiftKafka</span>\n\n<span class=\"token keyword\">let</span> config <span class=\"token operator\">=</span> <span class=\"token function\">KafkaConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nconfig<span class=\"token punctuation\">.</span>autoOffsetReset <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span>beginning\nconfig<span class=\"token punctuation\">.</span>brokerAddressFamily <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span>v4\nconfig<span class=\"token punctuation\">.</span>groupId <span class=\"token operator\">=</span> <span class=\"token string\">\"exampleGroup\"</span>\n<span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> consumer <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> <span class=\"token function\">KafkaConsumer</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">let</span> connection <span class=\"token operator\">=</span> consumer<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>brokers<span class=\"token punctuation\">:</span> <span class=\"token string\">\"localhost:9092\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Connected to <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>connection<span class=\"token delimiter variable\">)</span></span> brokers\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Waiting for messages from Kafka:\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">try</span> consumer<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>topics<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"example\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> records <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> consumer<span class=\"token punctuation\">.</span><span class=\"token function\">poll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> record <span class=\"token keyword\">in</span> records <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Consumed message: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>record<span class=\"token punctuation\">.</span>value <span class=\"token keyword\">as</span> <span class=\"token builtin\">Any</span><span class=\"token delimiter variable\">)</span></span> from offset <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>record<span class=\"token punctuation\">.</span>offset<span class=\"token delimiter variable\">)</span></span>\"</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error thrown: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>error<span class=\"token punctuation\">.</span>localizedDescription<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This code will initialize a new KafkaConsumer. We have configured our producer to only connect to brokers on IPv4 since we are running on localhost, to begin consuming from the start of all messages and to consume with a group id of “exampleGroup”. We then connect to the Kafka server we started earlier on the default port of “9092”. The program will then read messages from the “example” topic and print the message.</p>\n<p>You can test this out by running the program:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ swift run</code></pre></div>\n<p>Once the consumer connects to Kafka it should consume all the messages you sent from the producer and print them to the terminal.</p>\n<h2 id=\"next-steps\"><a href=\"#next-steps\" aria-label=\"next steps permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next steps</h2>\n<p>Congratulations! You have just set up an Apache Kafka event stream platform and connected a producer and consumer in Swift.</p>\n<p>If you would like learn more about SwiftKafka, <a href=\"https://github.com/Kitura/SwiftKafka\">check it out on GitHub</a>.</p>\n<p>If you would like to learn more about using the SwiftKafka API, <a href=\"https://kitura.github.io/SwiftKafka/index.html\">visit our API reference</a>.</p>\n<p>Any questions or comments? Please join the Kitura community on <a href=\"http://swift-at-ibm-slack.mybluemix.net/?cm_sp=dw-bluemix-_-swift-_-devcenter&#x26;_ga=2.118803593.186671014.1570626561-1743126121.1570022962&#x26;cm_mc_uid=83263075142115698398229&#x26;cm_mc_sid_50200000=53695431570707266328\">Slack</a>!</p>","frontmatter":{"path":"/blogs/swift-kafka-event-streams","title":"Introducing SwiftKafka: Accessing Event Streams in Swift","author":"Andrew Lees","date":"2019-08-13"}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}